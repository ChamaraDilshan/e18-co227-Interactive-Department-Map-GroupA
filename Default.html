<!DOCTYPE html>
<html>
<head>
    <title>My Website</title>   <!--Name of the website -->
    <link rel="stylesheet" href="style.css"/>   <!--Linking the css file-->
</head>
<body>
    <script src="three.js"></script>            <!-- Importing the three.js library-->
    <script src="jquery.js"></script>           <!-- Importing the jquery.js library-->
    <script src="threex.domevents.js"></script> <!-- Importing the threex.domevents.js library-->
    <script src="GLTFLoader.js"></script>       <!-- Importing the GLTFLoader.js library-->
    <script type="text/javascript">             
        var angle_x=0,angle_y=0;                //Starting rotation values of the camera
        var clicked = 0;                //To check whether a building has been clicked or not
        var expanding = 0;              //To check if top right labels are expanding or not
        var expanded = 0;               //To check whether top right main label has been expanded or not


//Database
        //This database is used to load the information about the buildings
        var departmentDatabase;
        
        //Data of a particular room can be added to the database as an array
        var building0 = ["Department Building","<li>Welcome to Computer Engineering Department</li><li>Head of the department is Mr.Rohitha</li><li>This is a 4 story building</li>","</li>Welcome to Computer Engineering Department</li><li>University of Peradeniya</li><li>Head of the department is Mr.Rohitha (BsC .jhbasdvll)<li></li>This is a 4 story building which has 4 labs and bla bla bla</li>"];
        var building1 = ["Building 1","<li>blue colour</li><li>height-10m</li><li>Dr. Namal</li>","<li>This is a blue colour building</li><li>Height of this builing is 10m.</li><li>This building belongs to Dr. Namal</li><li>His mobiile number is 012545466</li>"];
        var building2 = ["Building 2","<li>yellow colour</li><li>height-8m</li><li>Dr. Kelum</li>","<li>This is a yellow colour building</li><li>Height of this builing is 8m.</li><li>This building belongs to Dr. Kelum</li><li>His mobiile number is 064664646</li>"];
        var building3 = ["Building 3","<li>red colour</li><li>height-10m</li><li>Dr. Amal</li>","<li>This is a red colour building</li><li>Height of this builing is 10m.</li><li>This building belongs to Dr. Amal</li><li>His mobiile number is 46461331136</li>"];
        var building4 = ["Building 4","<li>green colour</li><li>height-10m</li><li>Dr. Chamindu</li>","<li>This is a green colour building</li><li>Height of this builing is 10m.</li><li>This building belongs to Dr. Chamindu</li><li>His mobiile number is 0164643</li>"];
        var building5 = ["Building 5","<li>orange colour</li><li>height-6m</li><li>Dr. Sujeewa</li>","<li>This is a orange colour building</li><li>Height of this builing is 6m.</li><li>This building belongs to Dr. Sujeewa</li><li>His mobiile number is 012540313</li>"];
        var building6 = ["Building 6","<li>pink colour</li><li>height-8m</li><li>Dr. Thamindu</li>","<li>This is a pink colour building</li><li>Height of this builing is 8m.</li><li>This building belongs to Dr. Thamindu</li><li>His mobiile number is 012986133032</li>"];

        departmentDatabase = [building0,building1,building2,building3,building4,building5,building6];
        

        //Scene
        var scene = new THREE.Scene();
        //Camera
        var camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight);
        //Renderer
        var renderer = new THREE.WebGLRenderer({antilias:true});
        renderer.setSize(window.innerWidth*0.98,window.innerHeight*0.98);      
        $('body').append(renderer.domElement);    
        
        
//Creating Backgroud
        //Import images to the cube
        let materialArray = [];
        let texture_ft = new THREE.TextureLoader().load('./images/4.png');
        let texture_bk = new THREE.TextureLoader().load('./images/5.png');
        let texture_up = new THREE.TextureLoader().load('./images/2.png');
        let texture_dn = new THREE.TextureLoader().load('./images/6.png');
        let texture_rt = new THREE.TextureLoader().load('./images/3.png');
        let texture_lf = new THREE.TextureLoader().load('./images/1.png');

        materialArray.push(new THREE.MeshBasicMaterial({map: texture_ft}));
        materialArray.push(new THREE.MeshBasicMaterial({map: texture_bk}));
        materialArray.push(new THREE.MeshBasicMaterial({map: texture_up}));
        materialArray.push(new THREE.MeshBasicMaterial({map: texture_dn}));
        materialArray.push(new THREE.MeshBasicMaterial({map: texture_rt}));
        materialArray.push(new THREE.MeshBasicMaterial({map: texture_lf}));

        for(let i=0;i<6;i++){
            materialArray[i].side = THREE.BackSide;
        }

        let skyboxGeo = new THREE.BoxGeometry(1500,250,1500);       //Creats the backgroud cube
        let skybox = new THREE.Mesh(skyboxGeo, materialArray);
        scene.add(skybox);
        skybox.rotation.z -= Math.PI/2;         //Set the position of the cube
        skybox.position.set(121,0,0);


//Mouse Event Listeners
        const domEvents = new THREEx.DomEvents(camera,renderer.domEvents);

        function addMouseEvents(cube, buildingID){                                      //This function sets particular mouse event listeners to building objects
            domEvents.addEventListener(cube,'click',event => {                          //Click listener (Signals when user has clicked on the building)
                if(clicked){                                                            //If user has already clicked (it means now he has clicked to unclick the previous click)
                    document.getElementById("main_information").style.opacity = 0.6;    //Decrease the opacity of top right main information label to 0.5 
                    document.getElementById("hint").innerHTML = "Click on the building for more details";
                    cube.material.opacity = 0;
                    clicked = !clicked;                                                 //change the 'clicked' flag to 0
                }else{                                                                  //If user hasn't clicked earlier
                    document.getElementById("main_information").style.opacity = 1;    //Decrease the opacity of top right main information label to 0.5
                    document.getElementById("hint").innerHTML = "More details below â†“";
                    cube.material.opacity = 0.3;
                    clicked = !clicked;                                                 //change the 'clicked' flag to 1
                }
            });
            domEvents.addEventListener(cube,'mousemove',event => {                      //Onmousemove listener (Signals when mouse pointer is moving on the building)
                if(clicked==0){                                                         //If user hasn't clicked some building (logic is when user has clicked on a particular building, data on the labels are not changing unitil he again clicks on that)
                    cube.material.opacity = 0.2;
                    document.getElementById("label").innerHTML = departmentDatabase[buildingID][0];                 //Update the particular information about the building appearing on the top right labels
                    document.getElementById("list").innerHTML = departmentDatabase[buildingID][1];
                    document.getElementById("list2").innerHTML = departmentDatabase[buildingID][2];
                }
            });    
            domEvents.addEventListener(cube,'mouseout',event => {                       //Onmouseout listener (Signals when mouse pointer is moving out from the building)
                if(clicked==0){                                                         //If user hasn't clicked some building (logic is when user has clicked on a particular building, data on the labels are not changing unitil he again clicks on that)
                    cube.material.opacity = 0;
                    document.getElementById("label").innerHTML = departmentDatabase[0][0];                             //Update the default information about the department on the top right labels
                    document.getElementById("list").innerHTML = departmentDatabase[0][1];
                    document.getElementById("list2").innerHTML = departmentDatabase[0][2];
                }
            });    
        }


//Import Blender Objects
        let buildingloader = new THREE.GLTFLoader();    //Create a loader to load the objects

        function importObject(buildingId,location,xValue,yValue,zValue,xrotatevalue){   //This function imports the blender object, sets the position, angle and adds to the scene
            var blenderBuilding;
            buildingloader.load(location,(gltf) => {
                blenderBuilding = gltf.scene;
                blenderBuilding.scale.set(1,1,1);                                            //Set the scale of the object
                scene.add(blenderBuilding);                                                  //Add to the scene
                blenderBuilding.position.x = xValue;                                         //Set the position
                blenderBuilding.position.y = yValue;
                blenderBuilding.position.z = zValue;
                blenderBuilding.rotation.z = Math.PI/2;                                      //Set the rotation
                blenderBuilding.rotation.x = xrotatevalue;
                blenderBuilding.rotation.y = Math.PI;
            });
            return blenderBuilding;
        }


//Creating Transparent Objects
        var transparentMaterialArray = [];
        for(var i=0;i<7;i++){
            transparentMaterialArray[i] = new THREE.MeshBasicMaterial({color: 0xffffff, transparent:true, opacity:0});
        }
        function createTransparentObject(buildingID,x,y,z,xPosition,yPosition,zPosition){
            var geometry = new THREE.BoxGeometry(x,y,z);
            var material = transparentMaterialArray[buildingID]
            var cube = new THREE.Mesh(geometry,material);
            scene.add(cube);
            cube.position.x = xPosition;
            cube.position.y = yPosition;
            cube.position.z = zPosition;
            addMouseEvents(cube,buildingID);
            return cube;
        }


//Set Lights
        let light1,light2,light3,light4,light5,light6,light7,light8,light9,light10;                                      //Initialize a light
        function setDirectionalLight(lightId,X,Y,Z) {                           //This function set the light
            lightId = new THREE.DirectionalLight(0xffffff,1); //Soft white light
            scene.add(lightId);                           //Add light to the scene
            lightId.position.set(X,Y,Z);
        }

        function setPointLight(lightId,X,Y,Z) {                           //This function set the light
            lightId = new THREE.PointLight(0xffffff,0.3); //Soft white light
            scene.add(lightId);                           //Add light to the scene
            lightId.position.set(X,Y,Z);
        }


//Controls
        async function sleep(miliseconds){  //This function sleeps for particular time 
            return new Promise((resolve) => setTimeout(resolve,miliseconds));
        }

        async function turnleft(){          //This function turns the camera to left by unit amount
            for(var i =0;i<10;i++){         //Used a loop for smooth movements
                await sleep(20);                        //Sleep for 20 millieseconds
                camera.rotation.x += Math.PI/200;       //Rotate the cmaera around x axis by 0.9 degrees to the left
                angle_x = angle_x + Math.PI/200;        //Update the new camera angle
            }
        }
        async function turnright(){         //This function turns the camera to left by unit amount
            for(var i =0;i<10;i++){         //Used a loop for smooth movements
                await sleep(20);                        //Sleep for 20 millieseconds
                camera.rotation.x -= Math.PI/200;       //Rotate the camera around x axis by 0.9 degrees to the right
                angle_x = angle_x - Math.PI/200;        //Update the new camera angle
            } 
        }
        async function turnup(){            //This function turns the camera to left by unit amount
            for(var i =0;i<10;i++){         //Used a loop for smooth movements
                await sleep(20);                        //Sleep for 20 millieseconds
                camera.rotation.y -= Math.PI/200;       //Rotate the cmaera around y axis by 0.9 degrees to the up 
                angle_y = angle_y - Math.PI/200;        //Update the new camera angle
            }
        }
        async function turndown(){          //This function turns the camera to left by unit amount
            for(var i =0;i<10;i++){         //Used a loop for smooth movements
                await sleep(20);                        //Sleep for 20 millieseconds
                camera.rotation.y += Math.PI/200;       //Rotate the camera around y axis by 0.9 degrees to the down
                angle_y = angle_y + Math.PI/200;        //Update the new camera angle
            }
        }
        async function forward(){           //This function brings the camera to back by unit amount
            for(var i =0;i<10;i++){         //Used a loop for smooth movements
                await sleep(20);                                    //Sleep for 20 millieseconds
                camera.position.y += 2*(Math.sin(angle_x)/10);      //Change the position of camera on y axis towards the facing direction
                camera.position.z -= 2*(Math.cos(angle_x)/10);      //Change the position of camera on z axis towards the facing direction
            }
        }
        async function backward(){          //This function brings the camera to front by unit amount
            for(var i =0;i<10;i++){         //Used a loop for smooth movements
                await sleep(20);                                    //Sleep for 20 millieseconds
                camera.position.y -= (Math.sin(angle_x)/10);        //Change the position of camera on y axis towards the facing direction
                camera.position.z += (Math.cos(angle_x)/10);        //Change the position of camera on z axis towards the facing direction
            }
        }


//Information Panel movements
        async function showInformation(){               //This function shrinks the top right main information label and makes the more information label appear
            if(clicked&&(!expanding)&&(!expanded)){     //If a building is clicked, labels are not expanding currently and more information label is dissappeared
                expanding=1;                            //set the expanding flag to 1
                document.getElementById("label2").innerHTML = "More information about "+document.getElementById("label").innerHTML;     //set the second label
                for(var i =0;i<10;i++){                 //Used a loop for smooth animations
                    await sleep(20);                    //Sleep for 20 millieseconds
                    document.getElementById("list").style.opacity = 1-(0.1*(i+1));                  //dissappears the main information list
                    document.getElementById("more_information").style.opacity = 0.09*(i+1);         //Shows the more information label
                    document.getElementById("main_information").style.height = 50-4.4*(i+1)+"%";   //Shrinks the main information label
                }
                document.getElementById("hint").style.backgroundColor = "#21618C";
                expanding=0;        //set the expanding flag to 0
                expanded = 1;       //Set the expanded flag to 1
            }
        }

        async function hideInformation(){               //This function expands the top right main information label and makes the more information label dissappear
            if(clicked&&(!expanding)&&expanded){        //If a building is clicked, labels are not expanding currently and more information label is appeared
                expanding=1;                            //set the expanding flag to 1
                document.getElementById("list").style.opacity = 1;      //Shows the main information list
                for(var i =0;i<10;i++){                 //Used a loop for smooth animations
                    await sleep(20);                    //Sleep for 20 millieseconds
                    document.getElementById("more_information").style.opacity = 0.9-0.09*(i+1);     //Dissappears the more information label
                    document.getElementById("main_information").style.height = 6+4.4*(i+1)+"%";    //Expands the main information label
                }
                document.getElementById("hint").style.backgroundColor = "#0B5345";
                expanding=0;            //set the expanding flag to 0
                expanded = 0;           //Set the expanded flag to 0
            }
        }


//Camera Position
        async function changeView(){
            if(camera.position.x==0){
                for(var i=0;i<10;i++){
                    await sleep(20);
                    camera.position.x=(i+1)*0.8;
                    camera.rotation.y = angle_y-(i+1)*((angle_y-Math.PI/8)/10);
                    
                }
                angle_y = Math.PI/8;
                document.getElementById("viewButton").innerHTML = "First Person";
            }else{
                document.getElementById("viewButton").innerHTML = "Third Person";
                for(var i=0;i<10;i++){
                    await sleep(20);
                    camera.position.x=8-((i+1)*0.8);
                    camera.rotation.y = angle_y-(i+1)*(angle_y/10);
                }
                angle_y = 0;
                document.getElementById("viewButton").innerHTML = "Third Person";
            }
        }


//Key Controls
        document.onkeydown = function(event){   //Set event listeners for key presses
            switch (event.keyCode){
                case 37:    //arrow left
                    turnleft();
                    break;
                case 38:    //Aroow up
                    forward();
                    break;
                case 39:    //Arrow right
                    turnright();
                    break;
                case 40:    //Arrow down
                    backward();
                    break;
                case 83:    //Letter s
                    turnup();
                    break;
                case 65:    //Letter a
                    turndown();
                    break;
            }
        }


//Rendering
        var animate = function(){
            
            renderer.render(scene,camera);
            requestAnimationFrame(animate);
        };


        //Load the blender 3D objects by using the created function above
        var blenderBuilding1 = importObject(blenderBuilding1,'./blender-objects/blue1.gltf',2,6,-14,Math.PI/2);        //Blue
        var blenderBuilding2 = importObject(blenderBuilding2,'./blender-objects/yellow2.gltf',1,-6,-13,-Math.PI/2);    //Yellow
        var blenderBuilding3 = importObject(blenderBuilding3,'./blender-objects/red3.gltf',2,-6,-19.1,-Math.PI/2);     //Red
        var blenderBuilding4 = importObject(blenderBuilding4,'./blender-objects/green4.gltf',2,6,-24,Math.PI/2);       //Green
        var blenderBuilding5 = importObject(blenderBuilding5,'./blender-objects/orange5.gltf',0,1.9,-26,Math.PI/2);    //Orange
        var blenderBuilding6 = importObject(blenderBuilding6,'./blender-objects/pink6.gltf',1,-6,-26,-Math.PI/2);      //Pink
        var blenderBuilding7 = importObject(blenderBuilding7,'./blender-objects/floor.gltf',-3.6,0,-18,-Math.PI/2);    //Floor

        //Creating transparent objects by using the created function above
        var cube1 = createTransparentObject(1,10.2,4.2,8.2,2,6,-14);        //Blue
        var cube2 = createTransparentObject(2,8.2,4.2,6.2,1,-6,-13);        //Yellow
        var cube3 = createTransparentObject(3,10.2,4.2,6.2,2,-6,-19.1);     //Red
        var cube4 = createTransparentObject(4,10.2,4.2,6.2,2,6,-24);        //Green
        var cube5 = createTransparentObject(5,6.2,4.2,2.2,0,1.9,-26);       //Orange
        var cube6 = createTransparentObject(6,8.2,4.2,2.2,1,-6,-26);        //Pink
     
        //Set lights by using the created function above
        setPointLight(light5,6,6,-14);      //Blue
        setPointLight(light6,4,-6,-13);     //Yellow
        setPointLight(light7,6,-6,-19);     //Red
        setPointLight(light8,6,6,-24);      //Green
        setPointLight(light9,2,2,-26);      //Orange
        setPointLight(light10,4,-6,-26);    //Pink

        setDirectionalLight(light1,0,0,14);                                     //Use the function to set the light
        setDirectionalLight(light2,0,50,-30);
        setDirectionalLight(light3,20,-30,-10);
        setDirectionalLight(light4,20,30,-10);

        camera.position.x = 0;              //Set the camera elevation (default value is 0)
        camera.rotation.z -= Math.PI/2;     //Set the rotation of the camera

        animate();

    </script>

    <div class="controlLayoutColoured"></div>    <!--This is an invisible layout which used to sense mouse activities on the label-->
    <div id="information" class="information_class" >                    
        <div id ="main_information" class="main_information_class">                         <!--Top right main information label-->
            <p1 style="font-size: 25px;" id="label">Department Building</p1><br><br>
            <ul id="list" style="list-style-type:square">                                   <!--Top right main information list-->
                <li>Welcome to Computer Engineering Department</li>
                <li>Head of the department is Mr.Rohitha</li>
                <li>This is a 4 story building</li>
            </ul>
        </div>
        <div id="hint" class="hint_class">Click on the building for more details</div>
        <div id="more_information" class="more_information_class">                          <!--Top right more information label-->
            <h3 id="label2">More information here</h3>          
            <ul id="list2" style="list-style-type:square">                                             <!--Top right more information list-->
                <li>Welcome to Computer Engineering Department, University of Peradeniya.</li>
                <li>Head of the department is Mr.Rohitha (BsC .jhbasdvll)</li>
                <li">This is a 4 story building which has 4 labs and bla bla bla</li>
            </ul>
            <button id="moreButton" class="moreButton_class">More</button>
        </div>
    </div>
    <div class="controlLayout" onmouseover="showInformation()" onmouseout="hideInformation()"></div>    <!--This is an invisible layout which used to sense mouse activities on the label-->
    <button class="viewButtonClass" id="viewButton" onclick="changeView()">Third Person</button>
</body>

</html>