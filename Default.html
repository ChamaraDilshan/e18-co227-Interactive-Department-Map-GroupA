<!DOCTYPE html>
<html>
<head>
    <title>My Website</title>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>
    <script src="three.js"></script>
    <script src="jquery.js"></script>
    <script src="threex.domevents.js"></script>
    <script src="GLTFLoader.js"></script>
    <script type="text/javascript">
        var angle_x=0,angle_y=0;
        var clicked = 0, expanding = 0, expanded = 0;

        //Database
        var building0 = ["Department Building","Welcome to Computer Engineering Department","Head of the department is Mr.Rohitha","This is a 4 story building","Welcome to Computer Engineering Department, University of Peradeniya","Head of the department is Mr.Rohitha (BsC .jhbasdvll)","This is a 4 story building which has 4 labs and bla bla bla"];
        var building1 = ["Building 1","blue colour","height-10m","Dr. Namal","This is a blue colour building","Height of this builing is 10m.","This building belongs to Dr. Namal","His mobiile number is 012545466"];
        var building2 = ["Building 2","yellow colour","height-8m","Dr. Kelum","This is a yellow colour building","Height of this builing is 8m.","This building belongs to Dr. Kelum","His mobiile number is 064664646"];
        var building3 = ["Building 3","red colour","height-10m","Dr. Amal","This is a red colour building","Height of this builing is 10m.","This building belongs to Dr. Amal","His mobiile number is 46461331136"];
        var building4 = ["Building 4","green colour","height-10m","Dr. Chamindu","This is a green colour building","Height of this builing is 10m.","This building belongs to Dr. Chamindu","His mobiile number is 0164643"];
        var building5 = ["Building 5","orange colour","height-6m","Dr. Sujeewa","This is a orange colour building","Height of this builing is 6m.","This building belongs to Dr. Sujeewa","His mobiile number is 012540313"];
        var building6 = ["Building 6","pink colour","height-8m","Dr. Thamindu","This is a pink colour building","Height of this builing is 8m.","This building belongs to Dr. Thamindu","His mobiile number is 012986133032"];
        var building7 = ["Building 7","white floor","height-10m","Dr. Namal","This is a white colour building","This is a white colour floor.","This building belongs to Dr. Namal","His mobiile number is 0125863100"];

        var departmentDatabase = [building0,building1,building2,building3,building4,building5,building6,building7];

        //End of Database



        //Scene
        var scene = new THREE.Scene();
        //Camera
        var camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight);
        //Renderer
        var renderer = new THREE.WebGLRenderer({antilias:false});
        renderer.setSize(window.innerWidth,window.innerHeight);
        $('body').append(renderer.domElement);    
        
        const domEvents = new THREEx.DomEvents(camera,renderer.domEvents);

        function addMouseEvents(cube, buildingID){
            domEvents.addEventListener(cube,'click',event => {
                if(clicked){
                    document.getElementById("main_information").style.opacity = 0.5;
                    clicked = !clicked;
                }else{
                    document.getElementById("main_information").style.opacity = 0.8;
                    clicked = !clicked;
                }
            });
            domEvents.addEventListener(cube,'mousemove',event => {
                if(clicked==0){
                    document.getElementById("label").innerHTML = departmentDatabase[buildingID][0];
                    document.getElementById("main_description1").innerHTML = departmentDatabase[buildingID][1];
                    document.getElementById("main_description2").innerHTML = departmentDatabase[buildingID][2];
                    document.getElementById("main_description3").innerHTML = departmentDatabase[buildingID][3];
                    document.getElementById("more_description1").innerHTML = departmentDatabase[buildingID][4];
                    document.getElementById("more_description2").innerHTML = departmentDatabase[buildingID][5];
                    document.getElementById("more_description3").innerHTML = departmentDatabase[buildingID][6];
                }
            });    
            domEvents.addEventListener(cube,'mouseout',event => {
                if(clicked==0){
                    document.getElementById("label").innerHTML = "Department Building";
                    document.getElementById("label").innerHTML = departmentDatabase[0][0];
                    document.getElementById("main_description1").innerHTML = departmentDatabase[0][1];
                    document.getElementById("main_description2").innerHTML = departmentDatabase[0][2];
                    document.getElementById("main_description3").innerHTML = departmentDatabase[0][3];
                    document.getElementById("more_description1").innerHTML = departmentDatabase[0][4];
                    document.getElementById("more_description2").innerHTML = departmentDatabase[0][5];
                    document.getElementById("more_description3").innerHTML = departmentDatabase[0][6];
                }
            });    
        }

        let light;

        function setLight() {
            light = new THREE.AmbientLight(0xffffff); // soft white light
            scene.add(light);
        }

        setLight();


        let buildingMesh;
        
        let buildingloader = new THREE.GLTFLoader();

        buildingloader.load('https://raw.githubusercontent.com/RuchiraTharaka/e18-co227-Interactive-Department-Map-GroupA/main/blue-building.gltf',(gltf) => {
            buildingMesh = gltf.scene;
            buildingMesh.scale.set(0.2,0.2,0.2);
            scene.add(buildingMesh);
            buildingMesh.color = 0xffffff;
            buildingMesh.position.z = -14;
            buildingMesh.position.x = 0;
            buildingMesh.position.y = 2;
        });

        //Building1 (cube1) blue colour
        var geometry1 = new THREE.BoxGeometry(10,4,8);
        var material1 = new THREE.MeshBasicMaterial({color: 0x0813f9});
        // var material1 = new THREE.MeshBasicMaterial({color: 0x0813f9, transparent:true, opacity:0});
        var cube1 = new THREE.Mesh(geometry1,material1);
        scene.add(cube1);
        cube1.position.y = 6;
        cube1.position.x = 2;
        cube1.position.z = -14;
        addMouseEvents(cube1,1);

        //Building2 (cube2) yellow colour
        var geometry2 = new THREE.BoxGeometry(8,4,6);
        var material2 = new THREE.MeshBasicMaterial({color: 0xf2f908}); 
        var cube2 = new THREE.Mesh(geometry2,material2);
        scene.add(cube2);
        cube2.position.y = -6;
        cube2.position.x = 1;
        cube2.position.z = -13;
        addMouseEvents(cube2,2);

        //Building3 (cube3) red colour
        var geometry3 = new THREE.BoxGeometry(10,4,6);
        var material3 = new THREE.MeshBasicMaterial({color: 0xf90808}); 
        var cube3 = new THREE.Mesh(geometry3,material3);
        scene.add(cube3);
        cube3.position.y = -6;
        cube3.position.x = 2;
        cube3.position.z = -19;
        addMouseEvents(cube3,3);

        //Building4 (cube4) green colour
        var geometry4 = new THREE.BoxGeometry(10,4,6);
        var material4 = new THREE.MeshBasicMaterial({color: 0x1cb214}); 
        var cube4 = new THREE.Mesh(geometry4,material4);
        scene.add(cube4);
        cube4.position.y = 6;
        cube4.position.x = 2;
        cube4.position.z = -24;
        addMouseEvents(cube4,4);

        //Building5 (cube5) orange colour
        var geometry5 = new THREE.BoxGeometry(6,4,2);
        var material5 = new THREE.MeshBasicMaterial({color: 0xf79a23}); 
        var cube5 = new THREE.Mesh(geometry5,material5);
        scene.add(cube5);
        cube5.position.y = 2;
        cube5.position.z = -26;
        addMouseEvents(cube5,5);

        //Building6 (cube6) pink colour
        var geometry6 = new THREE.BoxGeometry(8,4,2);
        var material6 = new THREE.MeshBasicMaterial({color: 0xfc1Aff}); 
        var cube6 = new THREE.Mesh(geometry6,material6);
        scene.add(cube6);
        cube6.position.y = -6;
        cube6.position.x = 1;
        cube6.position.z = -26;
        addMouseEvents(cube6,6);

        //Floor (cube7) white colour
        var geometry7 = new THREE.BoxGeometry(1,22,24);
        var material7 = new THREE.MeshBasicMaterial({color: 0xffffff}); 
        var cube7 = new THREE.Mesh(geometry7,material7);
        scene.add(cube7);
        cube7.position.z = -18;
        cube7.position.x = -3.5;
        addMouseEvents(cube7,7);

        camera.rotation.z -= Math.PI/2; 

        async function sleep(miliseconds){
            return new Promise((resolve) => setTimeout(resolve,miliseconds));
        }

        async function turnleft(){
            for(var i =0;i<10;i++){
                await sleep(20);
                camera.rotation.x += Math.PI/200; 
                angle_x = angle_x + Math.PI/200;
            }
        }
        async function turnright(){
            for(var i =0;i<10;i++){
                await sleep(20);
                camera.rotation.x -= Math.PI/200;
                angle_x = angle_x - Math.PI/200;
            } 
        }
        async function turnup(){
            for(var i =0;i<10;i++){
                await sleep(20);
                camera.rotation.y -= Math.PI/200; 
                angle_y = angle_y - Math.PI/200;
            }
        }
        async function turndown(){
            for(var i =0;i<10;i++){
                await sleep(20);
                camera.rotation.y += Math.PI/200; 
                angle_y = angle_y + Math.PI/200;
            }
        }
        async function forward(){
            for(var i =0;i<10;i++){
                await sleep(20);
                camera.position.y += (Math.sin(angle_x)/10);
                camera.position.z -= (Math.cos(angle_x)/10);
            }
        }

        async function backward(){ 
            for(var i =0;i<10;i++){
                await sleep(20);
                camera.position.y -= (Math.sin(angle_x)/10);
                camera.position.z += (Math.cos(angle_x)/10);
            }
        }

        async function showInformation(){
            if(clicked&&(!expanding)&&(!expanded)){
                expanding=1;
                document.getElementById("label2").innerHTML = "More information about "+document.getElementById("label").innerHTML;
                for(var i =0;i<10;i++){
                    await sleep(20);
                    document.getElementById("list").style.opacity = 1-(0.1*(i+1));
                    document.getElementById("more_information").style.opacity = 0.08*(i+1);
                    document.getElementById("main_information").style.height = 200-14*(i+1)+"px";       
                }
                expanding=0;
                expanded = 1;
            }
        }

        async function hideInformation(){
            if(clicked&&(!expanding)&&expanded){
                expanding=1;
                document.getElementById("list").style.opacity = 1;
                for(var i =0;i<10;i++){
                    await sleep(20);
                    document.getElementById("more_information").style.opacity = 0.8-0.08*(i+1);
                    document.getElementById("main_information").style.height = 60+14*(i+1)+"px";   
                }
                expanding=0;
                expanded = 0;
            }
        }


        document.onkeydown = function(event){
            switch (event.keyCode){
                case 37:    //arrow left
                    turnleft();
                    break;
                case 38:    //Aroow up
                    forward();
                    break;
                case 39:    //Arrow right
                    turnright();
                    break;
                case 40:    //Arrow down
                    backward();
                    break;
                case 83:    //Letter s
                    turnup();
                    break;
                case 65:    //Letter a
                    turndown();
                    break;
            }
        }

        var animate = function(){
            
            renderer.render(scene,camera);
            requestAnimationFrame(animate);
        };
        animate();

    </script>
    
    <div id="information" class="information_class" >
        <div id ="main_information" class="main_information_class">
            <p1 style="font-size: 25px;" id="label">Department Building</p1><br><br>
            <ul id="list" style="list-style-type:square">
                <li id="main_description1">Welcome to Computer Engineering Department</li>
                <li id="main_description2">Head of the department is Mr.Rohitha</li>
                <li id="main_description3">This is a 4 story building</li>
            </ul>
        </div>
        <div id="more_information" class="more_information_class">
            <h3 id="label2">More information here</h3>
            <ul style="list-style-type:square">
                <li id="more_description1">Welcome to Computer Engineering Department, University of Peradeniya.</li>
                <li id="more_description2">Head of the department is Mr.Rohitha (BsC .jhbasdvll)</li>
                <li id="more_description3">This is a 4 story building which has 4 labs and bla bla bla</li>
            </ul>
            <button>More</button>
        </div>
    </div>
    <div class="controlLayout" onmouseover="showInformation()" onmouseout="hideInformation()"></div>
</body>

</html>